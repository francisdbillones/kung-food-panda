const fProductModel = require('../models/farmProduct')

// 1. Create a FarmProduct
exports.createFProduct = async (request, response) => {
    try{
        //assume request.body contains the farmProduct
        const [newID] = await fProductModel.insertFProduct(request.product)
        
        if(!newID){
            const msg = {line:"Error creating Farm Product", error:"Server did not return new ID"}
            return response.status(500).json(msg)
        }

        const msg = {
            line: "Farm Product created successfully",
            farmProductID: newID,
        }

        return response.status(201).json(msg)
    }
    catch (error){
        console.error('Error creating Farm Product', error)
        const msg = {
            line: "Farm Product creation failed",
            error: error.message
        }
        return response.status(500).json(msg)
    }
};
// 2. Delete a FarmProduct
exports.removeFProduct = async (request, response) => {
    try{
        const no_rows_affected = await fProductModel.deleteFProduct(
            request.farmID, request.productID)

        if(no_rows_affected > 0)
            return response.status(204).send()
        else
            return response.status(404).json({line: "Farm Product not found"})
    }
    catch (error){
        console.error('Error deleting Farm Product', error)
        const msg = {
            line: "Farm Product deletion failed",
            error: error.message
        }
        return response.status(500).json(msg)
    }
};

// 3. Edit a FarmProduct's information
exports.editFProduct = async (request, response) => {
    try{
        const no_rows_affected = await fProductModel.updateFProduct(
            request.farmID, request.productID, request.value)
        const msg = {
            line: "Farm Product updated successfully",
        }
        if(no_rows_affected > 0)
            return response.status(200).json(msg)
        else
            return response.status(404).json({line: "Farm Product not found"})
    }
    catch (error){
        console.error('Error updating Farm Product', error)
        const msg = {
            line: "Farm Product update failed",
            error: error.message
        }
        return response.status(500).json(msg)
    }
};

// 4. View a FarmProduct's information
exports.viewFProduct = async (request, response) => {
    try{
        if(request.filterBy === "All"){
            const records = await fProductModel.viewAllFProducts()
            const msg = {
                line: "All Farm Product information successfully fetched",
                data: records
            }

            if (records.length > 0)
                return response.status(200).json(msg)
            else
                return response.status(404).json({line: "No Farm Product/s found"})
        }
        else if(request.filterBy === "ProductID"){
            const records = await fProductModel.getFProductByProductID(request.productID)
            const msg = {
                line: "Farm Product information filtered by product ID successfully fetched",
                data: records
            }

            if (records.length > 0)
                return response.status(200).json(msg)
            else
                return response.status(404).json({line: "No Farm Product/s found"})
        }
        else if(request.filterBy === "FarmID"){
            const records = await fProductModel.getFProductByFarmID(request.farmID)
            const msg = {
                line: "Farm Product information filtered by farm ID successfully fetched",
                data: records
            }

            if (records.length > 0)
                return response.status(200).json(msg)
            else
                return response.status(404).json({line: "No Farm Product/s found"})
        }
        else if(request.filterBy === "PrimaryKeys"){
            const records = await fProductModel.getFProductByPKs(
                request.farmID, request.productID)
            const msg = {
                line: "Farm Product information filtered by farm and product ID successfully fetched",
                data: records
            }

            if (records.length > 0)
                return response.status(200).json(msg)
            else
                return response.status(404).json({line: "No Farm Product/s found"})
        }
        //request.filterBy is not valid
        else{
            return response.status(400).json({line:"Invalid filter/column"})
        }
    }
    catch (error){
        console.error('Error finding Farm Product/s', error)
        const msg = {
            line: "Farm Product/s could not be found",
            error: error.message
        }
        return response.status(500).json(msg)
    }
};